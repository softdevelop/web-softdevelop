/*!

Quicksand 1.3

Reorder and filter items with a nice shuffling animation.

Copyright (c) 2010 Jacek Galanciak (razorjack.net) and agilope.com
Big thanks for Piotr Petrus (riddle.pl) for deep code review and wonderful docs & demos.

Dual licensed under the MIT and GPL version 2 licenses.
http://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt
http://github.com/jquery/jquery/blob/master/GPL-LICENSE.txt

Project site: http://razorjack.net/quicksand
Github site: http://github.com/razorjack/quicksand

*/

(function(a){a.fn.quicksand=function(e,b){var d={duration:750,easing:"swing",attribute:"data-id",adjustHeight:"auto",adjustWidth:"auto",useScaling:false,enhancement:function(f){},selector:"> *",atomic:false,dx:0,dy:0,maxWidth:0,retainExisting:true};a.extend(d,b);if(a.browser.msie||(typeof(a.fn.scale)=="undefined")){d.useScaling=false}var c;if(typeof(arguments[1])=="function"){c=arguments[1]}else{if(typeof(arguments[2]=="function")){c=arguments[2]}}return this.each(function(y){var E;var B=[];var k;if(typeof(d.attribute)=="function"){k=a(e)}else{k=a(e).filter("["+d.attribute+"]").clone()}var C=a(this);var j=a(this).css("height");var t=a(this).css("width");var q,o;var l=false;var D=false;var m=a(C).offset();var n=[];var A=a(this).find(d.selector);var x=a(A).innerWidth();if(a.browser.msie&&parseInt(a.browser.version,10)<7){C.html("").append(k);return}var p=0;var u=function(){a(this).css("margin","").css("position","").css("top","").css("left","").css("opacity","");if(!p){p=1;if(!d.atomic){var F=C.find(d.selector);if(!d.retainExisting){C.prepend(v.find(d.selector));F.remove()}else{var i=a([]);v.find(d.selector).each(function(G){var H=a([]);if(typeof(d.attribute)=="function"){var I=d.attribute(a(this));F.each(function(){if(d.attribute(this)==I){H=a(this);return false}})}else{H=F.filter("["+d.attribute+'="'+a(this).attr(d.attribute)+'"]')}if(H.length>0){i=i.add(H);if(G===0){C.prepend(H)}else{H.insertAfter(C.find(d.selector).get(G-1))}}});F.not(i).remove()}if(l){C.css("height",q)}if(D){C.css("width",t)}}d.enhancement(C);if(typeof c=="function"){c.call(this)}}if(false===d.adjustHeight){C.css("height","auto")}if(false===d.adjustWidth){C.css("width","auto")}};var z=C.offsetParent();var w=z.offset();if(z.css("position")=="relative"){if(z.get(0).nodeName.toLowerCase()!="body"){w.top+=(parseFloat(z.css("border-top-width"))||0);w.left+=(parseFloat(z.css("border-left-width"))||0)}}else{w.top-=(parseFloat(z.css("border-top-width"))||0);w.left-=(parseFloat(z.css("border-left-width"))||0);w.top-=(parseFloat(z.css("margin-top"))||0);w.left-=(parseFloat(z.css("margin-left"))||0)}if(isNaN(w.left)){w.left=0}if(isNaN(w.top)){w.top=0}w.left-=d.dx;w.top-=d.dy;C.css("height",a(this).height());C.css("width",a(this).width());A.each(function(F){n[F]=a(this).offset()});a(this).stop();var s=0;var r=0;A.each(function(F){a(this).stop();var G=a(this).get(0);if(G.style.position=="absolute"){s=-d.dx;r=-d.dy}else{s=d.dx;r=d.dy}G.style.position="absolute";G.style.margin="0";if(!d.adjustWidth){G.style.width=(x+"px")}G.style.top=(n[F].top-parseFloat(G.style.marginTop)-w.top+r)+"px";G.style.left=(n[F].left-parseFloat(G.style.marginLeft)-w.left+s)+"px";if(d.maxWidth>0&&n[F].left>d.maxWidth){G.style.display="none"}});var v=a(C).clone();var g=v.get(0);g.innerHTML="";g.setAttribute("id","");g.style.height="auto";g.style.width=C.width()+"px";v.append(k);v.insertBefore(C);v.css("opacity",0);g.style.zIndex=-1;g.style.margin="0";g.style.position="absolute";g.style.top=m.top-w.top+"px";g.style.left=m.left-w.left+"px";if(d.adjustHeight==="dynamic"){C.animate({height:v.height()},d.duration,d.easing)}else{if(d.adjustHeight==="auto"){q=v.height();if(parseFloat(j)<parseFloat(q)){C.css("height",q)}else{l=true}}}if(d.adjustWidth==="dynamic"){C.animate({width:v.width()},d.duration,d.easing)}else{if(d.adjustWidth==="auto"){o=v.width();if(parseFloat(t)<parseFloat(o)){C.css("width",o)}else{D=true}}}A.each(function(F){var G=[];if(typeof(d.attribute)=="function"){E=d.attribute(a(this));k.each(function(){if(d.attribute(this)==E){G=a(this);return false}})}else{G=k.filter("["+d.attribute+'="'+a(this).attr(d.attribute)+'"]')}if(G.length){if(!d.useScaling){B.push({element:a(this),dest:G,style:{top:a(this).offset().top,left:a(this).offset().left,opacity:""},animation:{top:G.offset().top-w.top,left:G.offset().left-w.left,opacity:1}})}else{B.push({element:a(this),dest:G,style:{top:a(this).offset().top,left:a(this).offset().left,opacity:""},animation:{top:G.offset().top-w.top,left:G.offset().left-w.left,opacity:1,scale:"1.0"}})}}else{if(!d.useScaling){B.push({element:a(this),style:{top:a(this).offset().top,left:a(this).offset().left,opacity:""},animation:{opacity:"0.0"}})}else{B.push({element:a(this),animation:{opacity:"0.0",style:{top:a(this).offset().top,left:a(this).offset().left,opacity:""},scale:"0.0"}})}}});k.each(function(H){var G=[];var J=[];if(typeof(d.attribute)=="function"){E=d.attribute(a(this));A.each(function(){if(d.attribute(this)==E){G=a(this);return false}});k.each(function(){if(d.attribute(this)==E){J=a(this);return false}})}else{G=A.filter("["+d.attribute+'="'+a(this).attr(d.attribute)+'"]');J=k.filter("["+d.attribute+'="'+a(this).attr(d.attribute)+'"]')}var I;if(G.length===0&&J.length>0){if(!d.useScaling){I={opacity:"1.0"}}else{I={opacity:"1.0",scale:"1.0"}}var K=J.clone();var F=K.get(0);F.style.position="absolute";F.style.margin="0";if(!d.adjustWidth){F.style.width=x+"px"}F.style.top=J.offset().top-w.top+"px";F.style.left=J.offset().left-w.left+"px";K.css("opacity",0);if(d.useScaling){K.css("transform","scale(0.0)")}K.appendTo(C);if(d.maxWidth===0||J.offset().left<d.maxWidth){B.push({element:a(K),dest:J,animation:I})}}});v.remove();if(!d.atomic){d.enhancement(C);for(y=0;y<B.length;y++){B[y].element.animate(B[y].animation,d.duration,d.easing,u)}}else{$toDelete=C.find(d.selector);C.prepend(v.find(d.selector));for(y=0;y<B.length;y++){if(B[y].dest&&B[y].style){var f=B[y].dest;var h=f.offset();f.css({position:"relative",top:(B[y].style.top-h.top),left:(B[y].style.left-h.left)});f.animate({top:"0",left:"0"},d.duration,d.easing,u)}else{B[y].element.animate(B[y].animation,d.duration,d.easing,u)}}$toDelete.remove()}})}})(jQuery);